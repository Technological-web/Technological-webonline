<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados de Búsqueda</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    
    <style>
        body { font-family: 'Montserrat', sans-serif; background: #f5f5f5; }
        .card {
            border: none;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
            transition: transform .2s, box-shadow .2s;
        }
        .card:hover { transform: scale(1.04); box-shadow: 0 5px 15px rgba(0,0,0,0.25); }
        .product-img { height: 200px; object-fit: cover; border-radius: 8px; }
        .price { font-weight: bold; color: #28a745; }
        .btn-primary { background: #ff6815; border: none; }
        .btn-primary:hover { background: #e05510; }
        #searchTerm { color: #ff6815; font-weight: 700; }
        .alert { border-radius: 8px; }
    </style>
</head>
<body>

    <div class="container my-5">
    <h1 class="mb-5 d-flex align-items-center justify-content-between">
        <span>Resultados de Búsqueda para: <span id="searchTerm">...</span></span>
        <button onclick="window.history.back()" class="btn btn-primary btn-sm">← Volver</button>
    </h1>
        
        <div id="resultsContainer" class="row">
            <p id="loadingMessage" class="col-12 text-center text-muted">Buscando productos...</p>
        </div>
    </div>

    <script src="data.js"></script>

    <script>
        function getQueryVariable(variable) {
            const query = window.location.search.substring(1);
            const vars = query.split("&");

            for (let i = 0; i < vars.length; i++) {
                const pair = vars[i].split("=");
                if (decodeURIComponent(pair[0]) === variable) {
                    return decodeURIComponent(pair[1].replace(/\+/g, ' '));
                }
            }
            return null;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const searchTerm = getQueryVariable('q');
            const searchTermElement = document.getElementById('searchTerm');
            const resultsContainer = document.getElementById('resultsContainer');
            const loadingMessage = document.getElementById('loadingMessage');

            loadingMessage.style.display = 'none'; 

            if (searchTerm) {
                searchTermElement.textContent = `"${searchTerm}"`;
                
                // 1. Convertir el término a minúsculas
                const lowerSearchTerm = searchTerm.toLowerCase();

                // 2. Filtrar los productos
                const filteredProducts = ALL_PRODUCTS.filter(product => 
                    // Busca coincidencias en nombre, descripción o tags
                    product.nombre.toLowerCase().includes(lowerSearchTerm) || 
                    product.descripcion.toLowerCase().includes(lowerSearchTerm) ||
                    (product.tags && product.tags.includes(lowerSearchTerm))
                );

                if (filteredProducts.length > 0) {
                    // Si hay resultados, crea el HTML de las tarjetas
                    filteredProducts.forEach(product => {
                        const productHtml = `
                            <div class="col-md-3 mb-4">
                                <div class="card p-2">
                                    <img src="${product.imagen}" class="card-img-top product-img" alt="${product.nombre}">
                                    <div class="card-body text-center">
                                        <p class="card-text">${product.nombre}</p>
                                        <p class="price">S/ ${product.precio}</p>
                                        <a href="#" class="btn btn-sm btn-primary">Ver Detalle</a>
                                    </div>
                                </div>
                            </div>
                        `;
                        resultsContainer.insertAdjacentHTML('beforeend', productHtml);
                    });
                } else {
                    // Si no hay resultados
                    resultsContainer.innerHTML = '<div class="col-12"><div class="alert alert-warning" role="alert">No se encontraron productos que coincidan con su búsqueda. Intente con otro término.</div></div>';
                }
                
            } else {
                // Si la URL no tiene el parámetro 'q'
                searchTermElement.textContent = 'Indefinido';
                resultsContainer.innerHTML = '<div class="col-12"><div class="alert alert-danger" role="alert">Error: No se ha especificado un término de búsqueda.</div></div>';
            }
        });
    </script>
</body>
</html>